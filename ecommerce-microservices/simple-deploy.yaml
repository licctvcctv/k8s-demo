# 简化版K8s部署配置 - 去掉所有可能出错的配置
# 只保留最基本的部署配置

apiVersion: v1
kind: Namespace
metadata:
  name: ecommerce-microservices

---
# Service Discovery (Eureka)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: service-discovery
  namespace: ecommerce-microservices
spec:
  replicas: 1
  selector:
    matchLabels:
      app: service-discovery
  template:
    metadata:
      labels:
        app: service-discovery
    spec:
      containers:
      - name: service-discovery
        image: selimhorri/service-discovery-ecommerce-boot:0.1.0
        ports:
        - containerPort: 8761
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "dev"

---
apiVersion: v1
kind: Service
metadata:
  name: service-discovery-service
  namespace: ecommerce-microservices
spec:
  selector:
    app: service-discovery
  ports:
  - port: 8761
    targetPort: 8761

---
# Cloud Config
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cloud-config
  namespace: ecommerce-microservices
spec:
  replicas: 1
  selector:
    matchLabels:
      app: cloud-config
  template:
    metadata:
      labels:
        app: cloud-config
    spec:
      containers:
      - name: cloud-config
        image: selimhorri/cloud-config-ecommerce-boot:0.1.0
        ports:
        - containerPort: 9296
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "dev"

---
apiVersion: v1
kind: Service
metadata:
  name: cloud-config-service
  namespace: ecommerce-microservices
spec:
  selector:
    app: cloud-config
  ports:
  - port: 9296
    targetPort: 9296

---
# API Gateway
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-gateway
  namespace: ecommerce-microservices
spec:
  replicas: 1
  selector:
    matchLabels:
      app: api-gateway
  template:
    metadata:
      labels:
        app: api-gateway
    spec:
      containers:
      - name: api-gateway
        image: selimhorri/api-gateway-ecommerce-boot:0.1.0
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "dev"

---
apiVersion: v1
kind: Service
metadata:
  name: api-gateway-service
  namespace: ecommerce-microservices
spec:
  selector:
    app: api-gateway
  ports:
  - port: 8080
    targetPort: 8080
  type: LoadBalancer

---
# User Service
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
  namespace: ecommerce-microservices
spec:
  replicas: 1
  selector:
    matchLabels:
      app: user-service
  template:
    metadata:
      labels:
        app: user-service
    spec:
      containers:
      - name: user-service
        image: selimhorri/user-service-ecommerce-boot:0.1.0
        ports:
        - containerPort: 8700
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "dev"

---
apiVersion: v1
kind: Service
metadata:
  name: user-service
  namespace: ecommerce-microservices
spec:
  selector:
    app: user-service
  ports:
  - port: 8700
    targetPort: 8700
